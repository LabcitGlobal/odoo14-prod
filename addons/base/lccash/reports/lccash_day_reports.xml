<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="lccash_day_reports">
        	<t t-foreach="docs" t-as="doc">            
				<t t-call="web.html_container">
					<t t-call="web.external_layout">
						<div style="font:17px Helvetica,Arial !important;">
            				<div class="page">    
	            				<center><h2>Detalle de Reporte de Caja <span t-field="doc.date"/></h2></center>        				
    	        				<table class="table table-bordered">
        	    					<tbody>
            							<tr>
            								<td><strong>Administrador:</strong></td>
            								<td><span t-field="doc.name"/></td>
            								<td><strong>Cajero:</strong></td>
            								<td><span t-field="doc.create_uid"/></td>
            							</tr>
            							<tr>
            								<td><strong>Cambio:</strong></td>
	            							<td><span t-field="doc.mount"/></td>
    	        							<td><strong>Nota:</strong></td>
        	    							<td><span t-field="doc.note"/></td>
            							</tr>
            						</tbody>            					
            					</table>            				
            					<!-- DEPOSITOS -->
	            					<span t-set="total_payment_mount" t-value="0"/>
    	        					<span t-set="total_payment_paid" t-value="0"/>
        	    					<span t-set="total_payment_change" t-value="0"/>
										<t t-foreach="request.env['lccash.payment'].search([('date','=',doc.date),('company_id','=',int(doc.company_id)),('create_uid','=',int(str(doc.create_uid)[str(doc.create_uid).find('(')+1:str(doc.create_uid).find(',')]))])" t-as="objPayment">
	            							<span t-set="total_payment_mount" t-value="total_payment_mount + objPayment.mount"/>
    	        							<span t-set="total_payment_paid" t-value="total_payment_paid + objPayment.paid"/>
        	    							<span t-set="total_payment_change" t-value="total_payment_change + objPayment.change"/>
        	    						</t>
								<!-- RETIROS -->
										<span t-set="total_withdraw_mount" t-value="0"/>
    	        						<t t-foreach="request.env['lccash.withdraw'].search([('date','=',doc.date),('company_id','=',int(doc.company_id)),('create_uid','=',int(str(doc.create_uid)[str(doc.create_uid).find('(')+1:str(doc.create_uid).find(',')]))])" t-as="objWithdraw">
	        	    						<span t-set="total_withdraw_mount" t-value="total_withdraw_mount + objWithdraw.name"/>
	        	    					</t>
								<!-- RESUMEN -->      	    																	
								<center><h2>RESUMEN FINAL</h2></center>
								<span t-set="total_mount" t-value="doc.mount + total_payment_paid - total_payment_change - total_withdraw_mount"/>
								<table class="table table-bordered">
									<tbody>
										<tr>
											<td><strong>Cambio</strong></td>
											<td><span t-field="doc.mount"/></td>									
										</tr>
										<tr>
											<td><strong>Total Depositos</strong></td>
											<td><span t-esc="round(total_payment_paid - total_payment_change,2)"/></td>									
										</tr>
										<tr>
											<td><strong>Total Retiros</strong></td>
											<td><span t-esc="round(total_withdraw_mount,2)"/></td>									
										</tr>
										<tr>
											<td><strong>SALDO TOTAL</strong></td>
											<td><span t-esc="round(total_mount,2)"/></td>									
										</tr>
									</tbody>
								</table>
							</div>
            			</div>
            		</t>
            	</t>          		
            </t>
        </template>
    </data>
</odoo>